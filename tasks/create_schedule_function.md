## 概要
スケジュールに従い、GPIOをon/offする機能を実装する

## 機能
- スケジュールに従い、GPIOをon/offできる
- スケジュールはAPIで設定されたものを利用する。スケジュールAPIは実装済みである。
    - スケジュールのデータモデルは src/application/models.py のScheduleModelである
- アプリケーション起動時に、スケジュール動作を開始し、スケジュールによるGPIO on/offが動作する
- スケジュールをアップデートした時、スケジュール動作に即時反映する
- スケジュールはJST基準とする

## 要件確認1
1. スケジュール実行の詳細について

- 実行頻度: 毎日同じ時刻に実行するのか、特定の曜日のみなのか？
  - 毎日同じ時刻に実行する
- スケジュール形式: 現在はHH:MM形式ですが、これは毎日実行という理解で良いか？
  - 毎日実行である
- 重複スケジュール: 同じデバイス・同じ時刻で複数のスケジュールがある場合の処理は？
  - 複数のスケジュールは全て処理する。順序は考慮外とし、処理依存で良い。

2. スケジュール管理の仕組み

- バックグラウンド処理: スケジュール実行はどのような仕組みで行うか？
  - APSchedulerを利用する
- アプリケーション起動時の動作: 既存のスケジュールをどのタイミングで読み込んで開始するか？
  - src/aquamarine.pyのmain関数のタイミング

3. スケジュール更新の即時反映

- 更新検知: スケジュールAPIでCRUD操作があった時、実行中のスケジューラーにどう通知するか？
  - APSchedulerの使い方に従う
- 実行中スケジュールの停止: 削除されたスケジュールの実行を即座に停止する必要があるか？
  - 即座に停止する

4. タイムゾーンとエラーハンドリング

- JST基準: サーバーのタイムゾーン設定に依存するか、アプリケーション内でJSTを明示的に扱うか？
  - アプリケーション内でJSTを明示的に扱う
- GPIO制御失敗: スケジュール実行時にGPIO制御が失敗した場合の処理は？（ログ出力のみ？リトライ？）
  - ログ出力のみ

5. 既存コードとの統合

- サービス層: 新しいScheduleExecutorServiceのようなクラスを作成するか、既存のScheduleServiceを拡張するか？
  - 新しいScheduleExecutorServiceを作成する
- アプリケーション起動: src/aquamarine.pyのmain関数でスケジューラーを開始する

## 要件確認2
1. APSchedulerの依存関係について

- ライブラリ追加: APSchedulerを新しく追加する必要がありますが、requirements.txtに追加して良いか？
  - 追加して良い
- バージョン指定: 特定のバージョンを指定する必要があるか？
  - latestで良い

2. ScheduleExecutorServiceの詳細

- シングルトン: ScheduleExecutorServiceはアプリケーション全体で1つのインスタンスとして管理するか？
  - シングルトンにする
- 依存注入:
既存のサービスクラスと同様に、DIコンテナ的な仕組みで管理するか、それともグローバルインスタンスとして扱うか？
  - DIコンテナ的な仕組みで管理する

3. APIとの連携

- スケジュール作成時:
ScheduleService.create_schedule()でスケジュールをDBに保存した後、ScheduleExecutorServiceに即座に追加するか？
  - 即座に追加する
- スケジュール削除時:
ScheduleService.delete_schedule()でDBから削除した後、ScheduleExecutorServiceからも即座に削除するか？
  - 即座に削除する
- 更新処理: 現在はスケジュール更新のAPIがないが、将来的に追加される可能性を考慮した設計にするか？
  - 考慮しなくて良い

4. エラーハンドリングとログ

- ログレベル: GPIO制御失敗時のログはどのレベル（ERROR、WARNING等）で出力するか？
  - WARNINGとする
- ログ内容: どの程度詳細な情報をログに含めるか？（デバイス名、GPIO番号、時刻、エラー内容等）
  - デバイス名、GPIO番号、時刻、エラー内容にする

5. アプリケーション終了時の処理

- クリーンアップ: アプリケーション終了時にAPSchedulerを適切に停止する処理は必要か？
  - 考慮しなくて良い
- SIGTERM/SIGINT: シグナル処理でのグレースフルシャットダウンを考慮するか？
  - 考慮しなくて良い
